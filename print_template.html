<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Print Bill</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- GLOBAL RESET --- */
        * {
            box-sizing: border-box;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: #333; /* Dark background only for screen viewing */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- SCREEN VIEW (PREVIEW) --- */
        .invoice-box {
            background-color: #fff;
            background-image: url('bg.jpg'); 
            background-size: 100% 100%; /* Force stretch fit */
            background-position: center;
            background-repeat: no-repeat;
            
            width: 148mm;
            height: 210mm;
            
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        /* --- PRINT VIEW (ACTUAL OUTPUT - STRICT FIX) --- */
        @media print {
            /* 1. Tell Printer: A5 Paper, NO MARGINS */
            @page {
                size: A5 portrait;
                margin: 0mm !important; /* Zero margin is key */
            }

            /* 2. Reset Body for Print */
            html, body {
                width: 148mm;
                height: 210mm;
                margin: 0 !important;
                padding: 0 !important;
                background: none;
            }

            /* 3. Force Invoice to Fill Page Exactly */
            .invoice-box {
                position: fixed; /* Locks to top-left of paper */
                top: 0;
                left: 0;
                width: 148mm !important;
                height: 210mm !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none;
                box-shadow: none;
                
                /* Force Background Image */
                background-image: url('bg.jpg') !important;
                background-size: 100% 100% !important; /* Stretch to fill gaps */
                background-repeat: no-repeat !important;
                z-index: 999;
            }
        }

        /* --- INTERNAL DESIGN --- */
        .tint-layer {
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.80); 
            padding: 12px;
            display: flex;
            flex-direction: column;
        }

        .inner-border {
            border: 2px solid #002347;
            height: 100%;
            padding: 15px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .corner { position: absolute; width: 25px; height: 25px; border: 4px solid #b8860b; }
        .top-left { top: 4px; left: 4px; border-right: none; border-bottom: none; }
        .top-right { top: 4px; right: 4px; border-left: none; border-bottom: none; }
        .bottom-left { bottom: 4px; left: 4px; border-right: none; border-top: none; }
        .bottom-right { bottom: 4px; right: 4px; border-left: none; border-top: none; }

        header { margin-bottom: 15px; position: relative; display: flex; align-items: center; }
        .qr-container { position: absolute; left: 0; top: 5px; border: 3px solid #b8860b; padding: 4px; border-radius: 4px; background: white; z-index: 10; }
        
        .header-content { width: 100%; text-align: center; padding-left: 90px; }
        .super-header { font-family: 'Cinzel', serif; color: #7a1b1b; font-size: 16px; font-weight: bold; margin-bottom: 5px; }
        h1 { font-family: 'Cinzel', serif; color: #b8860b; margin: 0; font-size: 40px; letter-spacing: 2px; line-height: 1; }
        h2 { font-family: 'Cinzel', serif; color: #002347; margin: 0; font-size: 30px; letter-spacing: 1px; }
        .sub-header { font-size: 10px; text-transform: uppercase; margin-top: 8px; color: #555; font-weight: bold; }
        .address { font-size: 15px; margin-top: 8px; line-height: 1.4; font-weight: 500; color: #000; }

        .content { display: flex; flex: 1; gap: 20px; align-items: stretch; }
        .left-col { width: 36%; border-right: 1px solid #b8860b; padding-right: 15px; display: flex; flex-direction: column; justify-content: flex-start; }
        .right-col { width: 64%; display: flex; flex-direction: column; height: 100%; }

        .section-title { font-size: 11px; font-weight: bold; color: #002347; text-transform: uppercase; border-bottom: 2px solid #b8860b; padding-bottom: 4px; margin-bottom: 10px; }
        .info-block { margin-bottom: 12px; }
        .label { font-size: 9px; color: #666; font-weight: bold; text-transform: uppercase; }
        .value { font-size: 14px; font-weight: 600; color: #000; font-family: 'Playfair Display', serif; margin-top: 2px; }
        
        .bill-number-block { margin-top: 8px; background: rgba(184, 134, 11, 0.15); padding: 8px; border-left: 4px solid #b8860b; }
        .bill-label { display: block; font-size: 11px; font-weight: bold; color: #002347; text-transform: uppercase; }
        .bill-value-big { display: block; font-size: 28px; font-weight: 900; color: #002347; font-family: 'Roboto', sans-serif; margin-top: 4px; }
        .date-value { font-family: 'Roboto', sans-serif; font-weight: 600; font-size: 13px; }

        .table-header { background-color: #002347; color: white; padding: 8px 10px; display: flex; justify-content: space-between; font-size: 11px; font-weight: bold; text-transform: uppercase; border-radius: 3px; }
        .item-row { padding: 15px 8px; display: flex; justify-content: space-between; border-bottom: 1px dotted #b8860b; }
        .item-name { font-size: 16px; font-weight: bold; color: #222; margin-bottom: 4px; }
        .item-desc { font-size: 11px; font-style: italic; color: #666; }
        .item-price { font-size: 16px; font-weight: bold; font-family: 'Roboto', sans-serif; }

        .totals-area { margin-top: auto; border-top: 2px solid #b8860b; padding-top: 15px; text-align: right; }
        .total-row { display: flex; justify-content: flex-end; margin-bottom: 8px; font-size: 13px; }
        .total-label { margin-right: 20px; color: #555; font-weight: 600; }
        .total-value { width: 100px; text-align: right; font-family: 'Roboto', sans-serif; font-weight: bold; font-size: 14px; }
        .balance-row { display: flex; justify-content: flex-end; margin-top: 12px; font-size: 22px; font-weight: 900; color: #002347; border-top: 1px solid #ccc; padding-top: 8px; font-family: 'Roboto', sans-serif; }

        .footer-note { text-align: center; font-size: 10px; color: #7a1b1b; font-weight: bold; line-height: 1.4; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="invoice-box" id="invoice">
        <div class="tint-layer">
            <div class="inner-border">
                <div class="corner top-left"></div><div class="corner top-right"></div>
                <div class="corner bottom-left"></div><div class="corner bottom-right"></div>

                <header>
                    <div class="qr-container"><div id="qrcode-display"></div></div>
                    <div class="header-content">
                        <div class="super-header">‚ô•Ô∏èGohar Shahi Marhaba‚ô•Ô∏è</div>
                        <h1>ROYAL</h1>
                        <h2>SHERWANI</h2>
                        <div class="sub-header">Sherwani ‚Ä¢ Indo Western ‚Ä¢ Coat Pent ‚Ä¢ Jodhpuri</div>
                        <div class="address">Shop 5563, Katra Rathi, Nai Sarak, Delhi-06<br>Ph: 9990922834, 9990594606</div>
                    </div>
                </header>

                <div class="content">
                    <div class="left-col">
                        <div class="section">
                            <div class="section-title">Customer Details</div>
                            <div class="info-block"><div class="label">Customer</div><div class="value" id="pr-name">--</div></div>
                            <div class="info-block"><div class="label">Phone</div><div class="value date-value" id="pr-phone">--</div></div>
                        </div>
                        <div class="section" style="margin-top: 40px;"> 
                            <div class="section-title">Bill Info</div>
                            <div class="bill-number-block"><span class="bill-label">Bill Number</span><span class="bill-value-big" id="pr-bill">--</span></div>
                            <div class="info-block" style="margin-top: 15px;"><div class="label">Date</div><div class="value date-value"><span id="pr-date">--</span> <span id="pr-time" style="font-size: 11px; margin-left: 5px; color: #555;"></span></div></div>
                            <div class="info-block"><div class="label">Delivery</div><div class="value date-value" id="pr-del" style="color:#b8860b;">--</div></div>
                        </div>
                    </div>

                    <div class="right-col">
                        <div class="table-header"><span>Description</span><span>Amount</span></div>
                        <div id="pr-items-list" style="flex: 1;"></div>
                        <div class="totals-area">
                            <div class="total-row"><span class="total-label">Total Amount:</span><span class="total-value" id="pr-total">‚Çπ0</span></div>
                            <div class="total-row"><span class="total-label">Received:</span><span class="total-value" id="pr-rec">‚Çπ0</span></div>
                            <div class="balance-row"><span class="total-label">Balance:</span><span class="total-value" id="pr-bal">‚Çπ0</span></div>
                        </div>
                    </div>
                </div>

                <div class="footer-note">
                    PLEASE DO NOT COME ON SATURDAY/SUNDAY FOR DELIVERY<br>NO RETURN AND NO EXCHANGE<br>
                    <span style="font-weight:normal; font-size: 9px; margin-top: 5px; display:block; color:#555;">üôè Thank you for shopping with us! üôè</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            const dataStr = localStorage.getItem('royal_print_queue');
            
            if (!dataStr) {
                // Testing Mode if opened directly
                console.log("No data found, showing placeholder.");
                return;
            }

            const data = JSON.parse(dataStr);

            document.getElementById('pr-name').innerText = data.name;
            document.getElementById('pr-phone').innerText = data.phone;
            document.getElementById('pr-bill').innerText = data.billNo;
            document.getElementById('pr-date').innerText = data.date;
            document.getElementById('pr-time').innerText = data.time;
            document.getElementById('pr-del').innerText = data.delivery;
            
            document.getElementById('pr-total').innerText = "‚Çπ" + data.total;
            document.getElementById('pr-rec').innerText = "‚Çπ" + data.received;
            document.getElementById('pr-bal').innerText = "‚Çπ" + data.balance;

            const list = document.getElementById('pr-items-list');
            list.innerHTML = "";
            data.items.forEach(item => {
                let html = `
                <div class="item-row">
                    <div>
                        <div class="item-name">${item.desc}</div>
                        <div class="item-desc">${item.sub}</div>
                    </div>
                    <div class="item-price">‚Çπ${item.price}</div>
                </div>`;
                list.innerHTML += html;
            });

            new QRCode(document.getElementById('qrcode-display'), {
                text: data.billNo.toString(),
                width: 80, height: 80,
                colorDark : "#002347", colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });

            // Delayed print to allow image/font load
            setTimeout(() => {
                window.print();
            }, 800);
        };
    </script>
</body>
</html>
