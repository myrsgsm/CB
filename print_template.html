<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Sherwani - Invoice</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@900&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* A5 PAPER SETUP */
        @page { size: A5 portrait; margin: 0; }
        
        * { box-sizing: border-box; -webkit-print-color-adjust: exact; }

        body { 
            font-family: 'Poppins', sans-serif; 
            background: #fff; margin: 0; padding: 5mm; color: #000; 
            width: 148mm; height: 209mm; /* A5 Height */
            overflow: hidden; /* Prevents 2nd page spill */
        }

        /* --- OUTER BORDER FRAME --- */
        .frame {
            border: 3px solid #000;
            height: 100%; 
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* --- HEADER --- */
        .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 8px; margin-bottom: 8px; }
        
        /* New Stylish Font */
        .shop-name { 
            font-family: 'Cinzel Decorative', cursive; font-size: 40px; font-weight: 900; 
            color: #000; line-height: 1; margin-bottom: 5px; text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tagline { 
            font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 3px; 
            border-top: 1px solid #000; border-bottom: 1px solid #000; 
            display: inline-block; padding: 2px 10px; margin: 4px 0; 
        }
        
        .sub-items { font-size: 10px; font-weight: 700; color: #000; margin-top: 2px; }

        .address { font-size: 10px; margin-top: 5px; line-height: 1.2; font-weight: 600; }
        
        /* Updated Phone Styling with Flexbox for Logo */
        .phone { 
            font-size: 14px; font-weight: 900; margin-top: 3px; 
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }

        /* --- META GRID --- */
        .meta-grid { 
            display: flex; justify-content: space-between; border: 1px solid #000; 
            margin-bottom: 10px; background: #fff;
        }
        .meta-box { flex: 1; padding: 5px; text-align: center; border-right: 1px solid #000; }
        .meta-box:last-child { border-right: none; }
        .lbl { font-size: 9px; text-transform: uppercase; font-weight: 700; display: block; }
        .val { font-size: 12px; font-weight: 900; display: block; }

        /* --- CUSTOMER ROW --- */
        .cust-row { 
            display: flex; justify-content: space-between; font-size: 12px; 
            font-weight: 700; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 10px;
        }

        /* --- TABLE --- */
        .item-container { flex-grow: 1; } 
        
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { 
            background: #000; color: #fff; text-align: left; padding: 6px; 
            text-transform: uppercase; font-size: 10px; letter-spacing: 1px;
        }
        td { padding: 6px 4px; border-bottom: 1px solid #ccc; font-weight: 600; vertical-align: top; }
        .price-col { text-align: right; }
        
        /* --- TOTALS --- */
        .totals-section { 
            display: flex; justify-content: flex-end; margin-top: auto; 
            border-top: 2px solid #000; padding-top: 5px;
        }
        .totals-box { width: 60%; }
        .t-row { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 3px; font-weight: 600; }
        .grand { font-size: 16px; font-weight: 900; border-top: 2px dashed #000; border-bottom: 2px dashed #000; padding: 4px 0; margin-top: 4px; }

        /* PAID STAMP */
        .paid-box {
            display: none; border: 3px solid #000; color: #000; padding: 5px 25px;
            font-size: 20px; font-weight: 900; text-transform: uppercase; 
            letter-spacing: 5px; margin-top: 5px; transform: rotate(-3deg);
            text-align: center; width: fit-content; margin-left: auto;
        }

        /* --- FOOTER --- */
        .footer { text-align: center; margin-top: 10px; border-top: 2px solid #000; padding-top: 5px; }
        .alert { 
            font-size: 10px; font-weight: 700; background: #000; color: #fff; 
            padding: 4px; display: block; margin-bottom: 4px;
        }
        .thanks { font-family: 'Cinzel Decorative', cursive; font-size: 14px; font-weight: 900; }
        .terms { font-size: 9px; font-weight: 700; margin-top: 2px; }

    </style>
</head>
<body>

    <div class="frame">
        
        <div>
            <div class="header">
                <div class="shop-name">ROYAL SHERWANI</div>
                <div class="tagline">Exclusive Ethnic Wear</div>
                <div class="sub-items">Sherwani ‚Ä¢ Indo Western ‚Ä¢ Kurta Jacket ‚Ä¢ Coat Pent ‚Ä¢ Jodhpuri</div>
                
                <div class="address">
                    Shop no 5563, Katra Rathi, Main Road, Nai Sarak,<br>
                    Chandni Chowk, Delhi - 110094
                </div>
                
                <div class="phone">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="16" height="16" alt="WA">
                    9990922834, 9990594606
                </div>
            </div>

            <div class="meta-grid">
                <div class="meta-box">
                    <span class="lbl">Bill No.</span>
                    <span class="val" id="pr-bill">#000</span>
                </div>
                <div class="meta-box">
                    <span class="lbl">Date</span>
                    <span class="val" id="pr-date">...</span>
                </div>
                <div class="meta-box">
                    <span class="lbl">Delivery</span>
                    <span class="val" id="pr-del">...</span>
                </div>
            </div>

            <div class="cust-row">
                <span>üì± <span id="pr-mob">...</span></span>
                <span>üë§ <span id="pr-cust">...</span></span>
            </div>

            <div class="item-container">
                <table>
                    <thead>
                        <tr>
                            <th width="75%">Description</th>
                            <th width="25%" class="price-col">Amount</th>
                        </tr>
                    </thead>
                    <tbody id="pr-items-list"></tbody>
                </table>
            </div>
        </div>

        <div>
            <div class="totals-section">
                <div class="totals-box">
                    <div class="t-row" id="subtotal-row"><span>Sub Total:</span><span id="pr-total">‚Çπ0</span></div>
                    
                    <div id="paid-stamp" class="paid-box">PAID</div>

                    <div id="balance-details">
                        <div class="t-row"><span>Advance:</span><span id="pr-rec">‚Çπ0</span></div>
                        <div class="t-row grand"><span>BALANCE:</span><span id="pr-bal">‚Çπ0</span></div>
                    </div>
                </div>
            </div>

            <div class="footer">
                <div class="alert">‚ö†Ô∏è NOTE: Please call before coming to collect delivery.</div>
                <div class="thanks">Thanks for shopping!</div>
                <div class="terms">NO EXCHANGE | NO REFUND</div>
            </div>
        </div>

    </div>

    <script>
        window.onload = function() {
            try {
                const rawData = localStorage.getItem('royal_print_queue');
                if (!rawData) return;
                const data = JSON.parse(rawData);

                // DATA FILLING
                document.getElementById('pr-bill').innerText = "#" + data.billNo;
                document.getElementById('pr-del').innerText = data.delivery || "N/A";
                
                // Date Logic
                if (data.time && data.time !== 'undefined') {
                    document.getElementById('pr-date').innerText = `${data.date} ${data.time}`;
                } else {
                    document.getElementById('pr-date').innerText = data.date;
                }

                document.getElementById('pr-cust').innerText = data.customer || "Cash Customer";
                document.getElementById('pr-mob').innerText = data.mobile || "-";

                // ITEMS
                const list = document.getElementById('pr-items-list'); list.innerHTML = "";
                data.items.forEach(item => {
                    list.innerHTML += `
                    <tr>
                        <td>
                            <div>${item.desc}</div>
                            <div style="font-size:10px; font-weight:normal; color:#444;">${item.sub || ''}</div>
                        </td>
                        <td class="price-col">‚Çπ${item.price}</td>
                    </tr>`;
                });

                // PAYMENT LOGIC
                const total = parseFloat(data.total);
                const received = parseFloat(data.received);
                const balance = parseFloat(data.balance);

                document.getElementById('pr-total').innerText = "‚Çπ" + total;

                if (balance <= 0 || total === received) {
                    document.getElementById('balance-details').style.display = 'none';
                    document.getElementById('paid-stamp').style.display = 'block';
                    document.getElementById('subtotal-row').style.display = 'none'; 
                } else {
                    document.getElementById('balance-details').style.display = 'block';
                    document.getElementById('paid-stamp').style.display = 'none';
                    document.getElementById('pr-rec').innerText = "- ‚Çπ" + received;
                    document.getElementById('pr-bal').innerText = "‚Çπ" + balance;
                }

                setTimeout(() => { window.print(); }, 500);

            } catch (e) { alert("Error: " + e.message); }
        };
    </script>
</body>
</html>